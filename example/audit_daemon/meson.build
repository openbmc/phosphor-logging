c_args = [
  #'-fanalyzer',
  '-O2',
  '-Wall',
  #'-Wcpp',
  '-Wno-comment',
  #'-Werror',
  #'-Wnon-virtual-dtor',
  #'-Wunused-parameter',
  '-Wno-unused-parameter',
  #'-Wunused-variable',
  '-Wno-unused-variable',
  '-Wno-unused-but-set-variable',
  '-g',
  '-pipe',
  '-fpic',
  '-feliminate-unused-debug-types',
]

# Boost dependency configuration
cpp_args = [
  '-DBOOST_ASIO_DISABLE_CONCEPTS',
  '-DBOOST_ALL_NO_LIB',
  '-DBOOST_ALLOW_DEPRECATED_HEADERS',
  '-DBOOST_ASIO_DISABLE_THREADS',
  '-DBOOST_ASIO_NO_DEPRECATED',
  '-DBOOST_ASIO_SEPARATE_COMPILATION',
  '-DBOOST_BEAST_SEPARATE_COMPILATION',
  '-DBOOST_EXCEPTION_DISABLE',
  #'-DBOOST_NO_EXCEPTIONS',
  '-DBOOST_URL_NO_SOURCE_LOCATION',
  '-DJSON_NOEXCEPTION',
  '-DOPENSSL_NO_FILENAMES',
  '-DSDBUSPLUS_DISABLE_BOOST_COROUTINES',
]

yaml_gen_dep = dependency('phosphor-dbus-interfaces')

# Find the installed YAML directory, either from a configure option or
# by pulling it from the PDI dependency.
yamldir = get_option('yamldir')
if yamldir == ''
    yamldir = yaml_gen_dep.get_variable('yamldir')
endif

# Include Directories
auditd_inc = include_directories(
  [
    'include',
    '../../lib/include',
    '../../../build/gen'
  ]
)

# Sources
auditd_src = (
  [
    'src/audit_manager.cpp',
    'src/audit_config.cpp',
    'src/audit_main.cpp',
    'src/linux_audit.cpp',
    #'../../../build/gen/xyz/openbmc_project/Logging/Audit/Manager/server.cpp'
    yamldir + '/xyz/openbmc_project/Logging/Audit/Manager/server.cpp'
  ]
)

# Deps
auditd_dep = declare_dependency(
    link_args : [
      # sdeventplus
      '-lsdeventplus',

      # sdbusplus
      '-lsdbusplus',

      # phosphor
      '-lphosphor_logging',

      # systemd
      '-lsystemd',

      # math
      '-lm',

      # libaudit (linux-audit user space API)
      '-laudit'
    ],

    include_directories : include_directories('.')
)

boost_version = '>=1.82.0'
boost_modules = []

boost_args = [
  '-DBOOST_ASIO_DISABLE_THREADS',
  '-DBOOST_ALL_NO_LIB',
  '-DBOOST_SYSTEM_NO_DEPRECATED',
  '-DBOOST_ASIO_NO_DEPRECATED',
  '-DBOOST_NO_RTTI',
  '-DBOOST_NO_TYPEID'
]

boost_deps = dependency('boost',
    version: boost_version,
    modules: boost_modules)

executable(
  'phosphor-auditd',
  auditd_src,
  c_args: c_args,
  cpp_args: cpp_args,
  include_directories: auditd_inc,
  dependencies: [boost_deps, auditd_dep],
  #debug: true,
  install : true
)

subdir('include')